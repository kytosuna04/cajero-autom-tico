#include <iostream>
#include <string>

using namespace std;

// Estructura para representar una cuenta
struct Cuenta {
    int numero;
    string titular;
    double saldo;
    string pin;
};

// Declaración de funciones
void mostrarMenu();
void consultarSaldo(Cuenta cuenta);
void realizarRetiro(Cuenta &cuenta);
void realizarDeposito(Cuenta &cuenta);
void realizarTransferencia(Cuenta cuentas[], int total, int actual);
int buscarCuenta(Cuenta cuentas[], int total, int numero);

int main() {
    // Arreglo de 3 cuentas con saldos iniciales
    Cuenta cuentas[3];
    
    // Inicializar cuenta 1
    cuentas[0].numero = 101;
    cuentas[0].titular = "Juan Perez";
    cuentas[0].saldo = 5000.0;
    cuentas[0].pin = "1234";
    
    // Inicializar cuenta 2
    cuentas[1].numero = 102;
    cuentas[1].titular = "Maria Lopez";
    cuentas[1].saldo = 3000.0;
    cuentas[1].pin = "5678";
    
    // Inicializar cuenta 3
    cuentas[2].numero = 103;
    cuentas[2].titular = "Pedro Garcia";
    cuentas[2].saldo = 8000.0;
    cuentas[2].pin = "9012";
    
    int numeroCuenta;
    string pin;
    int indiceCuenta = -1;
    
    cout << "===== CAJERO AUTOMATICO =====" << endl;
    cout << "Ingrese numero de cuenta: ";
    cin >> numeroCuenta;
    
    // Buscar la cuenta
    indiceCuenta = buscarCuenta(cuentas, 3, numeroCuenta);
    
    if (indiceCuenta == -1) {
        cout << "Error: Cuenta no encontrada" << endl;
        return 1;
    }
    
    cout << "Ingrese PIN: ";
    cin >> pin;
    
    // Validar PIN
    if (cuentas[indiceCuenta].pin != pin) {
        cout << "Error: PIN incorrecto" << endl;
        return 1;
    }
    
    cout << "\nBienvenido " << cuentas[indiceCuenta].titular << endl;
    
    int opcion;
    
    // Menú principal
    do {
        mostrarMenu();
        cout << "Opcion: ";
        cin >> opcion;
        
        // Validar que la entrada sea un número
        if (cin.fail()) {
            cin.clear();
            cin.ignore(1000, '\n');
            cout << "\nError: Ingrese un numero valido\n" << endl;
            continue;
        }
        
        cout << endl;
        
        // Ejecutar opción seleccionada
        switch (opcion) {
            case 1:
                consultarSaldo(cuentas[indiceCuenta]);
                break;
                
            case 2:
                realizarRetiro(cuentas[indiceCuenta]);
                break;
                
            case 3:
                realizarDeposito(cuentas[indiceCuenta]);
                break;
                
            case 4:
                realizarTransferencia(cuentas, 3, indiceCuenta);
                break;
                
            case 5:
                cout << "Gracias por usar el cajero. Adios!" << endl;
                break;
                
            default:
                cout << "Opcion invalida" << endl;
        }
        
        cout << endl;
        
    } while (opcion != 5);
    
    return 0;
}

// Función para mostrar el menú
void mostrarMenu() {
    cout << "\n===== MENU PRINCIPAL =====" << endl;
    cout << "1. Consultar Saldo" << endl;
    cout << "2. Retirar Dinero" << endl;
    cout << "3. Depositar Dinero" << endl;
    cout << "4. Transferir Dinero" << endl;
    cout << "5. Salir" << endl;
    cout << "==========================" << endl;
}

// Función para consultar saldo
void consultarSaldo(Cuenta cuenta) {
    cout << "--- CONSULTA DE SALDO ---" << endl;
    cout << "Titular: " << cuenta.titular << endl;
    cout << "Saldo actual: $" << cuenta.saldo << endl;
}

// Función para realizar retiro (paso por referencia)
void realizarRetiro(Cuenta &cuenta) {
    double monto;
    
    cout << "--- RETIRO DE DINERO ---" << endl;
    cout << "Saldo disponible: $" << cuenta.saldo << endl;
    cout << "Ingrese monto a retirar: $";
    cin >> monto;
    
    // Validación de entrada
    if (cin.fail()) {
        cin.clear();
        cin.ignore(1000, '\n');
        cout << "Error: Monto invalido" << endl;
        return;
    }
    
    // Validar monto positivo
    if (monto <= 0) {
        cout << "Error: El monto debe ser mayor a cero" << endl;
        return;
    }
    
    // Validar saldo suficiente
    if (monto > cuenta.saldo) {
        cout << "Error: Saldo insuficiente" << endl;
        return;
    }
    
    // Realizar retiro
    cuenta.saldo = cuenta.saldo - monto;
    cout << "Retiro exitoso!" << endl;
    cout << "Nuevo saldo: $" << cuenta.saldo << endl;
}

// Función para realizar depósito (paso por referencia)
void realizarDeposito(Cuenta &cuenta) {
    double monto;
    
    cout << "--- DEPOSITO DE DINERO ---" << endl;
    cout << "Saldo actual: $" << cuenta.saldo << endl;
    cout << "Ingrese monto a depositar: $";
    cin >> monto;
    
    // Validación de entrada
    if (cin.fail()) {
        cin.clear();
        cin.ignore(1000, '\n');
        cout << "Error: Monto invalido" << endl;
        return;
    }
    
    // Validar monto positivo
    if (monto <= 0) {
        cout << "Error: El monto debe ser mayor a cero" << endl;
        return;
    }
    
    // Realizar depósito
    cuenta.saldo = cuenta.saldo + monto;
    cout << "Deposito exitoso!" << endl;
    cout << "Nuevo saldo: $" << cuenta.saldo << endl;
}

// Función para realizar transferencia (paso de arreglo por puntero)
void realizarTransferencia(Cuenta cuentas[], int total, int actual) {
    int numeroDestino;
    double monto;
    
    cout << "--- TRANSFERENCIA ---" << endl;
    cout << "Saldo disponible: $" << cuentas[actual].saldo << endl;
    cout << "Ingrese numero de cuenta destino: ";
    cin >> numeroDestino;

    // Validación de entrada
    if (cin.fail()) {
        cin.clear();
        cin.ignore(1000, '\n');
        cout << "Error: Numero de cuenta invalido" << endl;
        return;
    }
    
    // Buscar cuenta destino
    int indiceDestino = buscarCuenta(cuentas, total, numeroDestino);
    
    if (indiceDestino == -1) {
        cout << "Error: Cuenta destino no encontrada" << endl;
        return;
    }
    
    // No permitir transferencia a la misma cuenta
    if (indiceDestino == actual) {
        cout << "Error: No puede transferir a su misma cuenta" << endl;
        return;
    }
    
    cout << "Destinatario: " << cuentas[indiceDestino].titular << endl;
    cout << "Ingrese monto a transferir: $";
    cin >> monto;
    
    // Validación de entrada
    if (cin.fail()) {
        cin.clear();
        cin.ignore(1000, '\n');
        cout << "Error: Monto invalido" << endl;
        return;
    }
    
    // Validar monto positivo
    if (monto <= 0) {
        cout << "Error: El monto debe ser mayor a cero" << endl;
        return;
    }
    
    // Validar saldo suficiente
    if (monto > cuentas[actual].saldo) {
        cout << "Error: Saldo insuficiente" << endl;
        return;
    }
    
    // Realizar transferencia
    cuentas[actual].saldo = cuentas[actual].saldo - monto;
    cuentas[indiceDestino].saldo = cuentas[indiceDestino].saldo + monto;
    
    cout << "Transferencia exitosa!" << endl;
    cout << "Nuevo saldo: $" << cuentas[actual].saldo << endl;
}

// Función para buscar una cuenta por número (búsqueda en arreglo)
int buscarCuenta(Cuenta cuentas[], int total, int numero) {
    // Recorrer el arreglo
    for (int i = 0; i < total; i++) {
        if (cuentas[i].numero == numero) {
            return i; // Retorna el índice
        }
    }
    return -1; // No encontrada
}
